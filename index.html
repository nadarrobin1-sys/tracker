<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Trade Journal Pro 2026</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body{
  background:#000;
  color:#fff;
  font-family:Arial,Helvetica,sans-serif;
  margin:0;
  padding:20px;
}
h2{margin-bottom:10px}

.calendar{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:8px;
}
.day{
  border:1px solid #222;
  min-height:90px;
  padding:6px;
  cursor:pointer;
  position:relative;
  background:#000;
}
.day.profit{background:#003300}
.day.loss{background:#330000}
.day.selected{outline:2px solid #fff}

.day-num{
  font-size:14px;
  font-weight:bold;
}

.popup{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.85);
  display:none;
  align-items:center;
  justify-content:center;
}
.popup-content{
  background:#111;
  padding:20px;
  width:420px;
  border:1px solid #333;
}
.popup input{
  width:100%;
  margin-bottom:6px;
  padding:6px;
}
.popup button{
  width:100%;
  padding:8px;
  background:#00ff55;
  border:none;
  cursor:pointer;
  font-weight:bold;
}

.trade{
  display:flex;
  justify-content:space-between;
  font-size:13px;
  margin-top:4px;
}

canvas{margin-top:30px}
</style>
</head>

<body>

<h2>Trade Journal Pro 2026</h2>

<div class="calendar" id="calendar"></div>

<h3>Trades of Selected Day</h3>
<canvas id="chart" height="120"></canvas>

<div class="popup" id="popup">
  <div class="popup-content">
    <h3 id="popupDate"></h3>
    <input type="number" step="0.001" id="profitInput" placeholder="Profit / Loss">
    <button onclick="addTrade()">Add Trade</button>
    <div id="tradeList"></div>
    <br>
    <button onclick="closePopup()" style="background:#444;color:#fff">Close</button>
  </div>
</div>

<script>
const cal=document.getElementById("calendar");
const popup=document.getElementById("popup");
const popupDate=document.getElementById("popupDate");
const tradeList=document.getElementById("tradeList");
const profitInput=document.getElementById("profitInput");

let selected=null;
let chart;

const now=new Date();
const y=now.getFullYear();
const m=now.getMonth()+1;
const days=new Date(y,m,0).getDate();

function key(d){return `trades-${y}-${m}-${d}`}

function load(){
  cal.innerHTML="";
  for(let d=1;d<=days;d++){
    const div=document.createElement("div");
    div.className="day";
    div.innerHTML=`<div class="day-num">${d}</div>`;
    div.onclick=()=>selectDay(d,div);
    div.ondblclick=()=>openPopup(d);

    const trades=JSON.parse(localStorage.getItem(key(d))||"[]");
    if(trades.length){
      const total=trades.reduce((a,b)=>a+b,0);
      div.classList.add(total>=0?"profit":"loss");
    }
    cal.appendChild(div);
  }
}
load();

function selectDay(d,el){
  document.querySelectorAll(".day").forEach(x=>x.classList.remove("selected"));
  el.classList.add("selected");
  selected=d;
  drawChart();
}

function openPopup(d){
  selected=d;
  popupDate.textContent=`${d}-${m}-${y}`;
  popup.style.display="flex";
  renderTrades();
}

function closePopup(){
  popup.style.display="none";
  load();
  drawChart();
}

function addTrade(){
  const v=parseFloat(profitInput.value);
  if(isNaN(v))return;
  const trades=JSON.parse(localStorage.getItem(key(selected))||"[]");
  trades.push(+v.toFixed(3));
  localStorage.setItem(key(selected),JSON.stringify(trades));
  profitInput.value="";
  renderTrades();
}

function renderTrades(){
  const trades=JSON.parse(localStorage.getItem(key(selected))||"[]");
  tradeList.innerHTML="";
  trades.forEach((t,i)=>{
    const div=document.createElement("div");
    div.className="trade";
    div.innerHTML=`
      <span>${t.toFixed(3)}</span>
      <span style="cursor:pointer;color:red" onclick="delTrade(${i})">âœ–</span>`;
    tradeList.appendChild(div);
  });
}

function delTrade(i){
  let trades=JSON.parse(localStorage.getItem(key(selected))||"[]");
  trades.splice(i,1);
  if(trades.length)
    localStorage.setItem(key(selected),JSON.stringify(trades));
  else
    localStorage.removeItem(key(selected));
  renderTrades();
}

function drawChart(){
  if(!selected)return;
  const trades=JSON.parse(localStorage.getItem(key(selected))||"[]");
  if(chart)chart.destroy();
  chart=new Chart(document.getElementById("chart"),{
    type:"bar",
    data:{
      labels:trades.map((_,i)=>`T${i+1}`),
      datasets:[{
        data:trades,
        backgroundColor:trades.map(t=>t>=0?"#00ff55":"#ff3333")
      }]
    },
    options:{
      plugins:{legend:{display:false}},
      scales:{y:{ticks:{color:"#fff"},grid:{color:"#222"}},
              x:{ticks:{color:"#fff"},grid:{display:false}}}
    }
  });
}
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Trade Journal GitHub Issues DB</title>
<style>
body { font-family: Arial; background:#111; color:#fff; margin:0; padding:20px; }
.calendar { display:grid; grid-template-columns:repeat(7,1fr); gap:6px; margin:20px 0;}
.day { padding:15px; border-radius:6px; cursor:pointer; text-align:center; }
.green { background:#1f7a1f; }
.red { background:#7a1f1f; }
.neutral { background:#333; }
.modal { position:fixed; inset:0; background:#000a; display:none; justify-content:center; align-items:center; }
.box { background:#1a1a1a; padding:20px; border-radius:8px; width:300px; }
input,select,button { width:100%; padding:8px; margin-top:6px; background:#222; color:#fff; border:none; }
button{ cursor:pointer; margin-top:6px; }
</style>
</head>
<body>

<h2>ðŸ“… Trade Journal (GitHub Issues DB)</h2>

<div class="calendar" id="calendar"></div>

<!-- MODAL -->
<div class="modal" id="modal">
  <div class="box">
    <h3 id="modalDate"></h3>
    <select id="type">
      <option>Long</option>
      <option>Short</option>
    </select>
    <input id="lot" type="number" step="0.01" placeholder="Lot Size">
    <input id="pnl" type="number" placeholder="Profit / Loss">
    <button onclick="saveTrade()">Save</button>
    <button onclick="closeModal()">Close</button>
  </div>
</div>

<script>
const calendar = document.getElementById("calendar");
const modal = document.getElementById("modal");
let selectedDate = "";

// CONFIG - fill in your username and repo
const OWNER = "nadarrobin1-sys";   // your GitHub username
const REPO = "tracking";           // your repo name
let TOKEN = ""; // <<< PUT YOUR TOKEN HERE LOCALLY (DO NOT PUSH ONLINE)

// BUILD CALENDAR (current month)
function buildCalendar() {
    calendar.innerHTML="";
    const now = new Date();
    const year = now.getFullYear();
    const month = now.getMonth();
    const firstDay = new Date(year,month,1).getDay();
    const days = new Date(year,month+1,0).getDate();

    for(let i=0;i<firstDay;i++){ calendar.appendChild(document.createElement("div")); }

    for(let d=1; d<=days; d++){
        const div = document.createElement("div");
        div.className="day neutral";
        div.innerText=d;
        const dateStr = `${year}-${String(month+1).padStart(2,"0")}-${String(d).padStart(2,"0")}`;
        div.dataset.date = dateStr;
        div.onclick = ()=>openModal(dateStr);
        calendar.appendChild(div);
    }
}

buildCalendar();
loadTrades();

// MODAL FUNCTIONS
function openModal(date){
    selectedDate = date;
    document.getElementById("modalDate").innerText = date;
    modal.style.display="flex";
}
function closeModal(){ modal.style.display="none"; }

// SAVE TRADE TO GITHUB ISSUE
async function saveTrade(){
    if(!TOKEN){ alert("Set your GitHub token in code before saving!"); return; }
    const trade = {
        date: selectedDate,
        type: document.getElementById("type").value,
        lot: Number(document.getElementById("lot").value),
        pnl: Number(document.getElementById("pnl").value)
    };

    await fetch(`https://api.github.com/repos/${OWNER}/${REPO}/issues`,{
        method:"POST",
        headers:{
            "Accept":"application/vnd.github+json",
            "Authorization":`Bearer ${TOKEN}`
        },
        body: JSON.stringify({
            title: `Trade ${selectedDate}`,
            body: JSON.stringify(trade)
        })
    });
    closeModal();
    loadTrades();
}

// LOAD TRADES FROM ISSUES
async function loadTrades(){
    const res = await fetch(`https://api.github.com/repos/${OWNER}/${REPO}/issues`);
    const issues = await res.json();

    // Sum PnL per day
    const map = {};
    issues.forEach(issue=>{
        try{
            const t = JSON.parse(issue.body);
            if(!map[t.date]) map[t.date]=0;
            map[t.date]+=t.pnl;
        }catch(e){}
    });

    document.querySelectorAll(".day").forEach(d=>{
        const sum = map[d.dataset.date] || 0;
        d.className="day " + (sum>0?"green":sum<0?"red":"neutral");
    });
}
</script>
</body>
</html>
